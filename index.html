<script>
const yesBtn = document.getElementById('yesBtn');
const noBtn = document.getElementById('noBtn');
const dialogueBox = document.getElementById('dialogueBox');
const stopFlash = document.getElementById('stopFlash');

let noClickCount = 0;
let chaseStarted = false;

// Get button size including borders
function getButtonSize(btn) {
  const style = getComputedStyle(btn);
  const borderX = parseFloat(style.borderLeftWidth) + parseFloat(style.borderRightWidth);
  const borderY = parseFloat(style.borderTopWidth) + parseFloat(style.borderBottomWidth);
  return { width: btn.offsetWidth + borderX, height: btn.offsetHeight + borderY };
}

// Initialize button positions
yesBtn.style.top = "300px";
yesBtn.style.left = "30%";
noBtn.style.top = "300px";
noBtn.style.left = "60%";

// Show dialogue
function showDialogue(text, duration=10000) {
  dialogueBox.innerHTML = text;
  dialogueBox.style.display = 'block';
  if (duration > 0) {
    setTimeout(() => { dialogueBox.style.display = 'none'; }, duration);
  }
}

// Flash STOP
function flashStop() {
  stopFlash.style.display = 'block';
  setTimeout(() => { stopFlash.style.display = 'none'; }, 500);
}

// Teleport No button
function teleportNoButton() {
  const size = getButtonSize(noBtn);
  const x = Math.random() * (window.innerWidth - size.width);
  const y = Math.random() * (window.innerHeight - size.height);
  noBtn.style.left = x + "px";
  noBtn.style.top = y + "px";
}

// Start chase behavior
function startChase() {
  if (!chaseStarted) {
    chaseStarted = true;
    showDialogue("it gets tuah point"); // permanent first message
    setTimeout(() => {
      showDialogue("PLEASE JUST CLICK YES DEAR", 0);
    }, 30000);
  }
}

// --- No button click listener ---
noBtn.addEventListener('click', () => {
  noClickCount++;

  if (noClickCount === 1) {
    // First click → swap
    const yesPos = {top: yesBtn.style.top, left: yesBtn.style.left};
    yesBtn.style.top = noBtn.style.top;
    yesBtn.style.left = noBtn.style.left;
    noBtn.style.top = yesPos.top;
    noBtn.style.left = yesPos.left;
    showDialogue("I think you pressed the wrong button love... don't worry, I swapped them so you don't get confused again !! ❤️");

  } else if (noClickCount === 2) {
    // Second click → teleport + dialogue
    teleportNoButton();
    showDialogue('Here, I moved the wrong button to the side so you don\'t click it again... it\'s the button that says "yes" if you were unsure. Love you!!');

  } else if (noClickCount >= 3 && noClickCount <= 5) {
    // Third, fourth, fifth clicks → silent teleports
    teleportNoButton();

  } else if (noClickCount === 6) {
    // Sixth click → start chase
    startChase();

  } else {
    // Extra clicks after chase started → STOP
    flashStop();
  }
});

// Mousemove handler for gradual fleeing
document.addEventListener('mousemove', (e) => {
  if (!chaseStarted) return;

  const btnRect = noBtn.getBoundingClientRect();
  const btnX = btnRect.left + btnRect.width / 2;
  const btnY = btnRect.top + btnRect.height / 2;

  const dx = btnX - e.clientX;
  const dy = btnY - e.clientY;
  const distance = Math.sqrt(dx*dx + dy*dy);

  const size = getButtonSize(noBtn);
  const wiggleRadius = 250;
  const fleeRadius = 180;

  // Wobble animation
  noBtn.style.animation = (distance < wiggleRadius) ? "wiggle 0.3s infinite" : "";

  // Gradual flee
  if (distance < fleeRadius) {
    const moveX = (dx / distance) * 50;
    const moveY = (dy / distance) * 50;

    let newLeft = btnRect.left + moveX;
    let newTop = btnRect.top + moveY;

    newLeft = Math.max(0, Math.min(window.innerWidth - size.width, newLeft));
    newTop = Math.max(0, Math.min(window.innerHeight - size.height, newTop));

    noBtn.style.left = newLeft + "px";
    noBtn.style.top = newTop + "px";
  }
});
</script>
